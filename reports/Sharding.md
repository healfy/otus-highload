

Реализация - умный клиент  

## Решардинг

Модель решардинга N^2  
Решардинг без даунтайма:

В главной базе храним таблицу с состояниями шардов. 
Todo: минусы, оптимизация, вот это все
Состояния:

* Готов
* Добавляется
* Удаляется
* Ошибка

При определении шарда для запроса хеш функция учитывает только готовые шарды для 
определения целевого шарда. 

При необходимости добавить шарды:
1) В таблицу добавляются новые серверы статус "Добавляется"
2) Пересчитывается хеш для данных в старых таблицах.
3) Те записи, для которых хеш поменялся добавляются в новые шарды.
4) Статус новых шардов меняется на "Готов"
5) Со старых шардов удаляются лишние данные


При необходимости удалить шарды:
1) Пересчитывается хеш для данных в удаляемых шардах.
2) Данные переписываются на неудаляемые шарды.
3) Статус удаляемых шардов меняется на "Удаляется".
4) Шарды удаляются из базы.
